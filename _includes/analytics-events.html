<!-- Analytics Event Tracking with Debugging -->
{% if site.google_analytics %}
<script>
  // Wait for DOM to be ready
  document.addEventListener('DOMContentLoaded', function() {
    console.log('ðŸ” Analytics Events: Initializing...');

    // Check if gtag is loaded
    if (typeof gtag === 'undefined') {
      console.error('âŒ Analytics Events: gtag is not defined. GA4 may not be loaded.');
      return;
    }

    console.log('âœ… Analytics Events: gtag is loaded and ready');

    // Track Download Free Version button
    const downloadButton = document.getElementById('download-free-version');
    if (downloadButton) {
      downloadButton.addEventListener('click', function(e) {
        const version = this.getAttribute('data-version') || 'unknown';
        const downloadUrl = this.getAttribute('href');

        console.log('ðŸ“¥ Download Event Fired:', {
          event: 'download_free_version',
          category: 'engagement',
          label: 'Free Version ' + version,
          url: downloadUrl
        });

        // Send event to GA4
        gtag('event', 'download_free_version', {
          'event_category': 'engagement',
          'event_label': 'Free Version ' + version,
          'value': 0,
          'download_url': downloadUrl
        });

        console.log('âœ… Event sent to Google Analytics');
      });

      console.log('âœ… Download button event listener attached');
    } else {
      console.warn('âš ï¸ Download button (#download-free-version) not found on this page');
    }

    // Track external links (optional - useful for tracking outbound clicks)
    const externalLinks = document.querySelectorAll('a[href^="http"]:not([href*="' + window.location.hostname + '"])');
    externalLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        const url = this.getAttribute('href');

        console.log('ðŸ”— External Link Click:', url);

        gtag('event', 'click', {
          'event_category': 'outbound',
          'event_label': url,
          'transport_type': 'beacon'
        });
      });
    });

    if (externalLinks.length > 0) {
      console.log('âœ… Tracking ' + externalLinks.length + ' external links');
    }

    console.log('ðŸŽ‰ Analytics Events: Setup complete!');
  });

  // Helper function to test GA4 manually in console
  window.testGA4 = function() {
    if (typeof gtag === 'undefined') {
      console.error('âŒ gtag is not defined');
      return false;
    }

    console.log('ðŸ§ª Testing GA4...');
    gtag('event', 'test_event', {
      'event_category': 'test',
      'event_label': 'Manual test from console',
      'value': 1
    });
    console.log('âœ… Test event sent! Check GA4 Realtime > Events');
    return true;
  };

  console.log('ðŸ’¡ Tip: Type testGA4() in console to send a test event');
</script>
{% endif %}
